<!-- book_detail.html -->
{% extends 'base.html' %}
{% block title %}{{ book.title }}{% endblock %}
{% block content %}
{% set back_url = prev or url_for('index') %}
<h1 class="page-title">{{ book.title }}</h1>
<div class="book-container" style="max-width: 1100px; margin: 0 auto; padding: 30px 20px;">


    <div style="display: flex; flex-wrap: wrap; gap: 30px; justify-content: space-between; align-items: flex-start;">

        <!-- –õ–µ–≤—ã–π –±–ª–æ–∫ -->
        <div style="flex: 1; min-width: 240px; text-align: center;">
            <img src="{{ url_for('static', filename='covers/' + (book.cover_filename or 'book_cover.jpg')) }}"
                 alt="–û–±–ª–æ–∂–∫–∞"
                 style="width: 100%; max-width: 280px; height: auto; border-radius: 4px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
            <p style="margin-top: 15px;"><strong>–ê–≤—Ç–æ—Ä:</strong> {{ book.author }}</p>
        </div>

        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–ª–æ–∫ -->
        <div style="flex: 2; min-width: 300px;">
            <p style="margin-bottom: 20px;">{{ book.description }}</p>

            <h4>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h4>
            <ul style="list-style: none; padding-left: 0; line-height: 1.6;">
                <li><strong>–ñ–∞–Ω—Ä:</strong> {{ book.genre or '‚Äî' }}</li>
                <li><strong>–ì–æ–¥ –∏–∑–¥–∞–Ω–∏—è:</strong> {{ book.year }}</li>
                <li><strong>–í–µ—Å:</strong> {{ book.weight or '‚Äî' }}</li>
                <li><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> {{ book.rating }}</li>
            </ul>
        </div>

        <!-- –ü—Ä–∞–≤—ã–π –±–ª–æ–∫ -->
        <div style="flex: 0 0 280px; border: 1px solid #ccc; padding: 20px; border-radius: 8px; background-color: #f9f9f9;">
            <p><strong style="font-size: 24px;">{{ book.price }} ‚ÇΩ</strong></p>
            <p><span style="color: green;">–í –Ω–∞–ª–∏—á–∏–∏</span></p>

            <form action="{{ url_for('add_to_cart', book_id=book.id) }}" method="post" style="margin-top: 15px;">
                <input type="number" name="quantity" value="1" min="1" style="width: 60px; text-align: center;">
                <input type="hidden" name="prev" value="{{ prev }}">
                <button type="submit" style="margin-top: 10px;">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
            </form>

            <p style="margin-top: 20px;">üìç <strong>–î–æ—Å—Ç–∞–≤–∫–∞:</strong><br>–ü–æ–ª—É—á–∏—Ç–µ –≤ –º–∞–≥–∞–∑–∏–Ω–µ –∏–ª–∏ –∫—É—Ä—å–µ—Ä–æ–º</p>
        </div>

    </div>

    <hr style="margin: 40px 0;">

    <!-- –û—Ç–∑—ã–≤—ã -->
    <h3>–û—Ç–∑—ã–≤—ã</h3>
    {% if reviews %}
        <ul style="list-style: none; padding-left: 0; margin-top: 15px;">
            {% for review in reviews %}
                <li style="margin-bottom: 10px;">
                    <strong>{{ review.user.first_name }}</strong> ‚Äî <em>–æ—Ü–µ–Ω–∫–∞ {{ review.rating }}/5</em><br>
                    {{ review.text }}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p style="color: #777;">–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endif %}

    <!-- –§–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–∞ -->
    {% if current_user.is_authenticated %}
        <form method="post" action="{{ url_for('book_detail', book_id=book.id) }}" style="margin-top: 30px;">
            <input type="hidden" name="form_type" value="review">
            <input type="hidden" name="prev" value="{{ prev }}">
            <label>–û—Ü–µ–Ω–∫–∞:
                <select name="rating">
                    {% for r in range(1, 6) %}
                        <option value="{{ r }}">{{ r }}</option>
                    {% endfor %}
                </select>
            </label><br><br>
            <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:<br>
                <textarea name="text" required rows="4" cols="60" style="max-width: 100%;"></textarea>
            </label><br><br>
            <button type="submit">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
        </form>
    {% else %}
        <p><a href="{{ url_for('login') }}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤.</p>
    {% endif %}

    <a href="{{ back_url }}" class="floating-back-button">‚Üê –ù–∞–∑–∞–¥</a>

</div>
{% endblock %}
