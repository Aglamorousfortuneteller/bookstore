<!-- book_detail.html -->
{% extends 'base.html' %}
{% block title %}{{ book.title }}{% endblock %}
{% block content %}
{% set back_url = prev or url_for('index') %}
<h1 style="margin-bottom: 1px;">{{ book.title }}</h1>
<div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; gap: 20px;">

    <!-- –õ–µ–≤—ã–π –±–ª–æ–∫: –∞–≤—Ç–æ—Ä –∏ –æ–±–ª–æ–∂–∫–∞ -->
    <div style="flex: 1; min-width: 220px;">
        <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ book.author }}</p>
        <img src="https://media.istockphoto.com/id/162833278/nl/foto/blank-book.jpg?s=612x612&w=0&k=20&c=C-kb218UqFZ_ZdWg8ILDDcXDwpmYzwghnew_7VWZwm4=" 
             alt="–û–±–ª–æ–∂–∫–∞" style="width: 100%; height: auto; max-width: 300px; margin-bottom: 15px;">
    </div>

    <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–ª–æ–∫: –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
    <div style="flex: 2; min-width: 300px; padding: 20px; text-align: left;">
        <p>{{ book.description }}</p>

        <h4>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h4>
        <ul style="list-style: none; padding-left: 0;">
            <li><strong>–ñ–∞–Ω—Ä:</strong> {{ book.genre or '‚Äî' }}</li>
            <li><strong>–ì–æ–¥ –∏–∑–¥–∞–Ω–∏—è:</strong> {{ book.year }}</li>
            <li><strong>–í–µ—Å:</strong> {{ book.weight or '‚Äî' }}</li>
            <li><strong>–†–µ–π—Ç–∏–Ω–≥:</strong> {{ book.rating }}</li>
        </ul>
    </div>

    <!-- –ü—Ä–∞–≤—ã–π –±–ª–æ–∫: —Ü–µ–Ω–∞, –∫–Ω–æ–ø–∫–∞ –∏ –¥–æ—Å—Ç–∞–≤–∫–∞ -->
    <div style="flex: 0 0 280px; border: 1px solid #ccc; padding: 20px; border-radius: 8px;">
        <p><strong style="font-size: 24px;">{{ book.price }} ‚ÇΩ</strong></p>
        <p><span style="color: green;">–í –Ω–∞–ª–∏—á–∏–∏</span></p>

        <form action="{{ url_for('add_to_cart', book_id=book.id) }}" method="post">
            <input type="number" name="quantity" value="1" min="1" style="width: 50px;">
            <input type="hidden" name="prev" value="{{ prev }}">
            <button type="submit" style="margin-top: 10px;">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
        </form>

        <p style="margin-top: 20px;">üìç <strong>–î–æ—Å—Ç–∞–≤–∫–∞:</strong><br>–ü–æ–ª—É—á–∏—Ç–µ –≤ –±–ª–∏–∂–∞–π—à–µ–º –º–∞–≥–∞–∑–∏–Ω–µ –∏–ª–∏ –∫—É—Ä—å–µ—Ä–æ–º</p>
    </div>



</div>

<hr>

<h3>–û—Ç–∑—ã–≤—ã</h3>
{% if reviews %}
    <ul style="list-style: none; padding-left: 0;">
        {% for review in reviews %}
            <li><strong>{{ review.user.first_name }}</strong>: {{ review.text }} (–û—Ü–µ–Ω–∫–∞: {{ review.rating }}/5)</li>
        {% endfor %}
    </ul>
{% else %}
    <p>–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
{% endif %}

{% if current_user.is_authenticated %}
    <form method="post" action="{{ url_for('book_detail', book_id=book.id) }}" style="margin-top: 20px;">
        <input type="hidden" name="form_type" value="review">
        <input type="hidden" name="prev" value="{{ prev }}">
        <label>–û—Ü–µ–Ω–∫–∞:
            <select name="rating">
                {% for r in range(1, 6) %}
                    <option value="{{ r }}">{{ r }}</option>
                {% endfor %}
            </select>
        </label><br><br>
        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:<br>
            <textarea name="text" required rows="4" cols="40"></textarea>
        </label><br><br>
        <button type="submit">–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
    </form>
{% else %}
    <p><a href="{{ url_for('login') }}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤.</p>
{% endif %}
{% set back_url = prev or request.referrer or url_for('index') %}
<a href="{{ back_url }}" style="display: inline-block; margin-top: 20px; text-decoration: none;">‚Üê –ù–∞–∑–∞–¥</a>
    <br>
    <br>
    <br>
    <br> 
{% endblock %}
