{% extends 'base.html' %}
{% block title %}–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞{% endblock %}
{% block content %}
<h1>üì¶ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>

{% if cart_items %}
<ul>
    {% for item in cart_items %}
    <li>{{ item.book.title }} ‚Äî {{ item.quantity }} —à—Ç. √ó {{ item.book.price }} ‚ÇΩ</li>
    {% endfor %}
</ul>

<p><strong>–ò—Ç–æ–≥–æ:</strong> {{ "%.2f"|format(total) }} ‚ÇΩ</p>

<form method="post" action="{{ url_for('confirm_order') }}">
    <label>–§–∞–º–∏–ª–∏—è –ò–º—è:
        <input type="text" name="name" value="{{ current_user.first_name or '' }} {{ current_user.last_name or '' }}" required>
    </label><br><br>

    <label>–¢–µ–ª–µ—Ñ–æ–Ω:
        <input type="tel" name="phone" value="{{ current_user.phone or '' }}" required>
    </label><br><br>

    <label>–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏:
        <select name="delivery_method" id="delivery-method" required onchange="toggleDeliveryFields()">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
            <option value="courier">–ö—É—Ä—å–µ—Ä</option>
            <option value="postman">–ü–æ—á—Ç–∞</option>
            <option value="store">–°–∞–º–æ–≤—ã–≤–æ–∑</option>
        </select>
    </label><br><br>

    <div id="address-block" style="display:none;">
        <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:
            <input type="text" name="address">
        </label><br><br>
    </div>

    <div id="pickup-block" style="display:none;">
        <label>–ü—É–Ω–∫—Ç —Å–∞–º–æ–≤—ã–≤–æ–∑–∞:
            <select name="pickup_location">
                <option value="moscow_tverskaya_8">–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, –¥. 8</option>
                <option value="pushkina_kolotushkina">–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. –ö–æ–ª–æ—Ç—É—à–∫–∏–Ω–∞</option>
                <option value="zazhopinsk_pobedy_1"> –≥. –ó–∞–∂–æ–ø–∏–Ω—Å–∫, –ø—Ä. –ü–æ–±–µ–¥—ã, –¥. 1</option>
            </select>
        </label><br><br>
    </div>


    <p><strong>–û–ø–ª–∞—Ç–∞:</strong> –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</p>
    <p><strong>–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞:</strong> {{ "%.2f"|format(total) }} ‚ÇΩ</p>
    <p><strong>–î–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> {{ delivery_date }}</p>

    <input type="hidden" name="total" value="{{ total }}">
    <input type="hidden" name="delivery_date" value="{{ delivery_date }}">

    <button type="submit">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
</form>

<script>
function toggleDeliveryFields() {
    const method = document.getElementById("delivery-method").value;
    document.getElementById("address-block").style.display = (method === "courier" || method === "postman") ? "block" : "none";
    document.getElementById("pickup-block").style.display = (method === "store") ? "block" : "none";
}

</script>

{% else %}
<p>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.</p>
{% endif %}

<a href="{{ url_for('view_cart') }}" class="floating-back-button">‚Üê –ù–∞–∑–∞–¥ –≤ –∫–æ—Ä–∑–∏–Ω—É</a>

{% endblock %}
