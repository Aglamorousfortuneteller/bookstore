{% extends 'base.html' %}
{% block title %}–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞{% endblock %}
{% block content %}
<h1>üì¶ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>

{% if cart_items %}
<ul>
    {% for item in cart_items %}
    <li>{{ item.book.title }} ‚Äî {{ item.quantity }} —à—Ç. √ó {{ item.book.price }} ‚ÇΩ</li>
    {% endfor %}
</ul>
<p><strong>–ò—Ç–æ–≥–æ:</strong> {{ "%.2f"|format(total) }} ‚ÇΩ</p>


<form method="post" action="{{ url_for('checkout') }}">
    <p><strong>–ö—Ç–æ –±—É–¥–µ—Ç –∑–∞–±–∏—Ä–∞—Ç—å/–ø–æ–ª—É—á–∞—Ç—å –∑–∞–∫–∞–∑?</strong></p>
    <label><input type="radio" name="recipient_type" value="self" checked> –Ø ({{ current_user.first_name or '' }} {{ current_user.last_name or '' }}) </label><br>
    <label><input type="radio" name="recipient_type" value="other"> –î—Ä—É–≥–æ–π –ø–æ–ª—É—á–∞—Ç–µ–ª—å</label><br><br>

    <div>
        <label>–§–∞–º–∏–ª–∏—è –ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è:
            <input type="text" name="name"
                   value="{{ current_user.first_name or '' }} {{ current_user.last_name or '' }}" required>
        </label>
    </div><br>

    <label>–¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—è:
        <input type="tel" name="phone" value="{{ request.form.phone or current_user.phone }}" required>
    </label><br><br>

    <label>–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏:
        <select name="delivery_method" required>
            <option value="courier" {% if request.form.delivery_method == 'courier' %}selected{% endif %}>–î–æ—Å—Ç–∞–≤–∫–∞ –∫—É—Ä—å–µ—Ä–æ–º</option>
            <option value="postman" {% if request.form.delivery_method == 'postman' %}selected{% endif %}>–ü–æ—á—Ç–∞</option>
            <option value="store" {% if request.form.delivery_method == 'store' %}selected{% endif %}>–°–∞–º–æ–≤—ã–≤–æ–∑</option>
        </select>
    </label><br><br>

    {% if request.method == 'POST' %}
        {% if request.form.delivery_method in ['courier', 'postman'] %}
            <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏: <input type="text" name="address" required></label><br><br>
        {% elif request.form.delivery_method == 'store' %}
            <label>–ü—É–Ω–∫—Ç —Å–∞–º–æ–≤—ã–≤–æ–∑–∞:
                <select name="pickup_location" required>
                    <option value="store1">—É–ª. –õ–µ–Ω–∏–Ω–∞, 1</option>
                    <option value="store2">—É–ª. –ü–æ–±–µ–¥—ã, 12</option>
                    <option value="store3">–ø—Ä-—Ç –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, 45</option>
                </select>
            </label><br><br>
        {% endif %}
    {% endif %}

    <input type="hidden" name="confirm" value="yes">
    <button type="submit" formaction="{{ url_for('confirm_order') }}">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—é</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const selfRadio = document.querySelector('input[name="recipient_type"][value="self"]');
    const otherRadio = document.querySelector('input[name="recipient_type"][value="other"]');
    const nameField = document.querySelector('input[name="name"]');
    const phoneField = document.querySelector('input[name="phone"]');

    const defaultName = "{{ (current_user.first_name or '') ~ ' ' ~ (current_user.last_name or '') }}";
    const defaultPhone = "{{ current_user.phone or '' }}";

    function updateFields() {
        if (selfRadio.checked) {
            nameField.value = defaultName;
            phoneField.value = defaultPhone;
        } else if (otherRadio.checked) {
            nameField.value = '';
            phoneField.value = '';
        }
    }

    selfRadio.addEventListener('change', updateFields);
    otherRadio.addEventListener('change', updateFields);
});
</script>


{% else %}
<p>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è.</p>
{% endif %}

<br><a href="{{ url_for('view_cart') }}">‚Üê –ù–∞–∑–∞–¥ –≤ –∫–æ—Ä–∑–∏–Ω—É</a>
{% endblock %}
