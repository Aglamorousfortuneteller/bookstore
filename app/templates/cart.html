{% extends 'base.html' %}
{% block title %}–ö–æ—Ä–∑–∏–Ω–∞{% endblock %}
{% block content %}
<h1>üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h1>

{% if cart_items %}
<form method="post" action="{{ url_for('checkout') }}">
<div style="display: flex; gap: 30px; align-items: flex-start;">

    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div style="flex: 2;">
        <label>
            <input type="checkbox" id="select-all" onclick="
                const checkboxes = document.querySelectorAll('.item-checkbox');
                checkboxes.forEach(cb => cb.checked = this.checked);
                updateSelectedCount();
            "> –í—ã–±—Ä–∞—Ç—å –≤—Å–µ
        </label>
        <span id="selected-count" style="margin-left: 10px;">0 –≤—ã–±—Ä–∞–Ω–æ</span>

        <ul style="list-style: none; padding-left: 0;">
            {% for item in cart_items %}
            <li style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <input type="checkbox" class="item-checkbox" name="selected_items" value="{{ item.id }}">
                <img src="https://media.istockphoto.com/id/162833278/nl/foto/blank-book.jpg?s=612x612&w=0&k=20&c=C-kb218UqFZ_ZdWg8ILDDcXDwpmYzwghnew_7VWZwm4=" style="width: 60px; border: 1px solid #ccc;">
                <div style="flex: 1;">
                    <strong>{{ item.book.title }}</strong><br>
                    –ê–≤—Ç–æ—Ä: {{ item.book.author }}<br>
                    –ì–æ–¥: {{ item.book.year }}<br>
                    –¶–µ–Ω–∞: {{ item.book.price }} ‚ÇΩ
                </div>
                <div>
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:
                        <input type="number" name="quantities_{{ item.id }}" value="{{ item.quantity }}" min="1" style="width: 50px;">
                    </label>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
    <div style="flex: 1; border-left: 1px solid #ccc; padding-left: 20px;">
        <p><strong>–ò—Ç–æ–≥–æ:</strong> {{ "%.2f"|format(total) }} ‚ÇΩ</p>

        <button type="submit"
                style="background: none; border: none; color: blue; text-decoration: underline; cursor: pointer; padding: 0; margin-bottom: 10px;">
            –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é
        </button>

        <br><br>
        <button type="submit" formaction="{{ url_for('remove_selected') }}"
                style="background: none; border: 1px solid red; color: red; padding: 5px 10px; cursor: pointer;">
            –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
        </button>
    </div>
</div>
</form>
{% else %}
<p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.</p>
{% endif %}



<br>
<a href="{{ url_for('index') }}">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>

<script>
function updateSelectedCount() {
    const selected = document.querySelectorAll('.item-checkbox:checked').length;
    document.getElementById('selected-count').textContent = `${selected} –≤—ã–±—Ä–∞–Ω–æ`;
}

document.addEventListener('DOMContentLoaded', function () {
    const checkboxes = document.querySelectorAll('.item-checkbox');
    checkboxes.forEach(cb => cb.addEventListener('change', updateSelectedCount));
    updateSelectedCount();
});
</script>
{% endblock %}
